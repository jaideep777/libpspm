<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="libpspm">
<title>Computing size integrals â€¢ libpspm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing size integrals">
<meta property="og:description" content="libpspm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">libpspm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
    Home
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--tutorials">
    <span class="fa fa-book fa-lg"></span>
     
    Tutorials
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--tutorials">
    <a class="dropdown-item" href="../articles/size_integral.html">Computing size integrals</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--developer">
    <span class="fa fa-user-secret"></span>
     
    Developer
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--developer">
    <a class="dropdown-item" href="../articles/size_integral.html">Size integrals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../html/index.html">
    <span class="fa fa-code fa-lg"></span>
     
    API
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/news.html">
    <span class="fa fa-newspaper fa-lg"></span>
     
    News
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jaideep777/libpspm">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Computing size integrals</h1>
                        <h4 data-toc-skip class="author">Jaideep
Joshi</h4>
            
            <h4 data-toc-skip class="date">11 March 2022</h4>
      
      
      <div class="d-none name"><code>size_integral.Rmd</code></div>
    </div>

    
    
<p>In strucured population models, it is often desirable to compute
integrals over the physiological state variable <span class="math inline">\(x\)</span>, of the form</p>
<p><span class="math display">\[
I = \int_a^b w(x)u(x)dx
\]</span></p>
<p>where <span class="math inline">\(w(x)\)</span> is a weight function
and <span class="math inline">\(u(x)\)</span> is the density
function.</p>
<p>For example, if <span class="math inline">\(x\)</span> is body size
and we want to calculate the biomass of all indiviuals of a species, we
can compute the above integral with <span class="math inline">\(w(x)\)</span> defined as the function that scales
individual mass with size, such as an allometric equation: <span class="math inline">\(w(x)=\alpha x^\beta\)</span>.</p>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>libpspm provides two functions to easily to calculate size integrals.
E.g., to calculate biomass as in the example above, just define the
weights function</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> w <span class="op">=</span> <span class="op">[</span>a<span class="op">,</span>b<span class="op">](</span><span class="dt">double</span> x<span class="op">,</span> <span class="dt">double</span> t<span class="op">){</span><span class="cf">return</span> a<span class="op">*</span>pow<span class="op">(</span>x<span class="op">,</span>b<span class="op">);};</span></span></code></pre></div>
<p>and calculate the intgral as</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>integrate_x<span class="op">(</span>w<span class="op">,</span> t<span class="op">,</span> id<span class="op">);</span> <span class="co">// where t = time, id = species id</span></span></code></pre></div>
<p>Often, one needs to calculate the integral above a certain size
threshold. For example, say a forest census includes only trees above 10
cm diameter, and we want to predict the biomass only in the recorded
size classes. Then we want the lower limit of the integral to be <span class="math inline">\(x_{low}=10\)</span> cm, rather than the size at
birth. To do so, we can use the function</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>integrate_wudx_above<span class="op">(</span>w<span class="op">,</span> t<span class="op">,</span> xlow<span class="op">,</span> id<span class="op">);</span> <span class="co">// where t = time, id = species id</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="developer-notes">Developer notes<a class="anchor" aria-label="anchor" href="#developer-notes"></a>
</h2>
<!--\image html size_integral.png width=700cm-->
<p><img src="size_integral.png"></p>
<p>In libpspm, the computation of this integral depends on the solver
method. For different solvers, the integral is defined as follows:</p>
<p><code>FMU:</code> <span class="math inline">\(\quad I =
\sum_{i=i_0}^J h_i w_i u_i\)</span></p>
<p><code>EBT:</code> <span class="math inline">\(\quad I =
\sum_{i=i_0}^J w_i N_i\)</span>, with <span class="math inline">\(x_0 =
x_b + \pi_0/N_0\)</span></p>
<p><code>CM :</code> <span class="math inline">\(\quad I =
\sum_{i=i_0}^J h_i (w_{i+1}u_{i+1}+w_i u_i)/2\)</span></p>
<p>where <span class="math inline">\(i_0 = \text{argmax}(x_i \le
x_{low})\)</span>, <span class="math inline">\(h_i =
x_{i+1}-x_i\)</span>, and <span class="math inline">\(w_i =
w(x_i)\)</span>.</p>
<p>If interpolation is turned on, <span class="math inline">\(h_{i_0}=x_{i_0+1}-x_{low}\)</span>, whereas <span class="math inline">\(u(x_{low})\)</span> is set to <span class="math inline">\(u(x_{i_0})\)</span> in FMU and calculated by
bilinear interpolation in CM (See Figure). Interpolation does not play a
role in EBT.</p>
<p>In the CM method, the density of the boundary cohort is obtained from
the boundary condition of the PDE: <span class="math inline">\(u_b=B/g(x_b)\)</span>, where <span class="math inline">\(B\)</span> is the input flux of newborns. In the
current implementation of the CM method, <span class="math inline">\(B\)</span> must be set to a constant. In future
implementations which may allow real-time calculation of <span class="math inline">\(B\)</span>, <span class="math inline">\(u_b\)</span> must be calculated recurvisely by
solving <span class="math inline">\(u_b = B(u_b)/g(x_b)\)</span>, where
<span class="math inline">\(B(u_b) = \int_{x_b}^{x_m}
f(x)u(x)dx\)</span>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jaideep777.github.io" class="external-link">Jaideep
Joshi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
